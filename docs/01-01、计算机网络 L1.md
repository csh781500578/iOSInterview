[40 张图带你搞懂 TCP 和 UDP](https://mp.weixin.qq.com/s/wxzJrSLGDZ6tAt3ys4Vp8g)

[CS-Notes](http://www.cyc2018.xyz/#%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1)

[TOC]

# 网络七层协议(OSI七层模型)
- 应用层
- 

## 协议详解
- 应用层
    1. 用户接口、应用程序
    2. Application典型设备：网关
    3. 典型协议、标准和应用：TELNET、FTP、HTTP
- 表示层
    1. 数据表示、压缩和加密
    2. 典型设备：网关
    3. 典型协议、标准和应用：ASCLL、PICT、TIFF、JPEG|MPEG
    4. 表示层相当于一个东西的表示，表示的一些协议，比如图片、声音和视频MPEG
- 会话层
    1. 会话的建立和结束
    2. 典型设备：网关
    3. 典型协议、标准和应用：RPC、SQL、NFS、X WINDOWS、ASP
- 传输层
    1. 主要功能：端到端控制Transport
    2. 典型设备：网关
    3. 典型协议、标准和应用：TCP、UDP、SPX
- 网络层
    1. 主要功能：路由、寻址Network
    2. 典型设备：路由器
    3. 典型协议、标准和应用：IP、IPX、APPLETALK、ICMP
- 数据链路层
    1. 主要功能：保证无差错的疏忽链路的data link
    2. 典型设备：交换机、网桥、网卡
    3. 典型协议、标准和应用：802.2、802.3ATM、HDLC、FRAME RELAY
- 物理层
    1. 主要功能：传输比特流Physical
    2. 典型设备：集线器、中继器
    3. 典型协议、标准和应用：V.35、EIA/TIA-232

# TCP/IP四层模型
- 应用层
- 运输层
- 网络层
- 网络接口层

# 原理体系结构（五层模型）
- 应用层
- 运输层
- 网络层
- 数据链路层
- 物理层

# 常见的应用层协议
## DNS
域名系统DNS是因特网使用的命名系统，用来把便于人们使用的机器名字转换为IP地址。
## FTP
FTP是文件传输协议。FTP提供交互式的访问，允许客户指明文件类型与格式，并允许文件具有存取权限。FTP基于TCP。
## TELNET
telnet是一个简单的远程终端协议，它也是因特网的正式标准。又称为终端仿真协议。
## HTTP
超文本传送协议，是面向事务的应用层协议。http使用面向连接的TCP作为运输层协议，保证了数据的可靠传输。
## SMTP
简单邮件传送协议。
## POP3
邮件读取协议，POP3(Post Office Protocol 3)协议通常被用来接收电子邮件。
## SNMP
简单网络管理协议
## MQTT
消息队列遥测传输协议

# Cookie和Session
## cookie
- 1、用户和服务器的交互
cookie主要是用来记录用户状态，区分用户，状态保存在客户端。cookie功能需要浏览器的支持。如果浏览器不支持cookie（如大部分手机中的浏览器）或者把cookie禁用了，cookie功能就会失效。
![image](https://qn.nobady.cn/iOS/cookie.png)
    1. 首次访问amazon时，客户端发送一个HTTP请求到服务器端。服务器端发送一个HTTP响应到客户端，其中包含Set-Cookie头部
    2. 客户端发送一个HTTP请求到服务器端，其中包含Cookie头部。服务器端发送一个HTTP响应到客户端
    3. 隔段时间再去访问时，客户端会直接发包含Cookie头部的HTTP请求。服务器端发送一个HTTP响应到客户端。

- 2、cookie的修改和删除
    - 在修改cookie的时候，只需要新cookie覆盖旧cookie即可，在覆盖的时候，由于cookie具有不可跨域名性，注意name、path、domain需与原cookie一致
    - 删除cookie也一样，设置cookie的过期时间expires为过去的一个时间点，或者maxAge=0(有效期)即可

- 3、cookie的安全
    - 事实上，cookie的使用存在争议，因为它被认为是对用户隐私的一种侵害，而且cookie并不安全
    - HTTP协议不仅是无状态的，而且是不安全的。使用HTTP协议的数据不经过任何加密就直接在网络上传播，有被截获的可能。使用HTTP协议传输很机密的内容是一种隐患。
    1. 如果不希望Cookie在HTTP等非安全协议中传输，可以设置Cookie的secure属性为true。浏览器只会在HTTPS和SSL等安全协议中传输此类Cookie。
    2. 此外，secure属性并不能对Cookie内容加密，因而不能保证绝对的安全性。如果需要高安全性，需要在程序中对Cookie内容加密、解密，以防泄密。
    3. 也可以设置cookie为HttpOnly，如果在cookie中设置了HttpOnly属性，那么通过js脚本将无法读取到cookie信息，这样能有效的防止XSS（跨站脚本攻击）攻击

## Session
- Session是服务器端使用的一种记录客户端状态的机制，使用上比Cookie简单一些，相应的也增加了服务器的存储压力。
- Session是另一种记录客户状态的机制，不同的是Cookie保存在客户端浏览器中，而Session保存在服务器上。 客户端浏览器访问服务器的时候，服务器把客户端信息以某种形式记录在服务器上。这就是Session。客户端浏览器再次访问时只需要从该Session中查找该客户的状态就可以了。
![image](https://qn.nobady.cn/iOS/session.png)
- 如图：
- 当程序需要为某个客户端的请求创建一个session时，服务器首先检查这个客户端的请求里是否已包含了一个session标识（称为SessionId）
- 如果已包含则说明以前已经为此客户端创建过session，服务器就按照SessionId把这个session检索出来，使用（检索不到，会新建一个）
- 如果客户端请求不包含SessionId，则为此客户端创建一个session并且生成一个与此session相关联的SessionId，SessionId的值应该是一个既不会重复，又不容易被找到规律以仿造的字符串，这个SessionId将被在本次响应中返回给客户端保存。
- 保存这个SessionId的方式可以采用cookie，这样在交互过程中浏览器可以自动的按照规则把这个标识发送给服务器。但cookie可以被人为的禁止，则必须有其他机制以便在cookie被禁止时仍然能够把SessionId传递回服务器。

## Cookie 和Session 的区别：
- 1、cookie数据存放在客户的浏览器上，session数据放在服务器上。
- 2、cookie相比session不是很安全，别人可以分析存放在本地的cookie并进行cookie欺骗,考虑到安全应当使用session。
- 3、session会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能,考虑到减轻服务器性能方面，应当使用cookie。
- 4、单个cookie保存的数据不能超过4K，很多浏览器都限制一个站点最多保存20个cookie。而session存储在服务端，可以无限量存储
- 5、所以：将登录信息等重要信息存放为session;其他信息如果需要保留，可以放在cookie中

# DNS是什么
因特网上的主机，可以使用多种方式标识，比如主机名或IP地址。一种标识方法就是用它的主机名（hostname），比如·www.baidu.com、www.google.com、gaia.cs.umass.edu等。这方式方便人们记忆和接受，但是这种长度不一、没有规律的字符串路由器并不方便处理。还有一种方式，就是直接使用定长的、有着清晰层次结构的IP地址，路由器比较热衷于这种方式。为了折衷这两种方式，我们需要一种能进行主机名到IP地址转换的目录服务。这就是域名系统（Domain Name System，DNS）的主要任务。

- DNS是：
    - 1、一个由分层的DNS服务器实现的分布式数据库
    - 2、一个使得主机能够查询分布式数据库的应用层协议

- DNS服务器通常是运行BIND软件的UNIX机器，DNS协议运行在UDP上，使用53号端口
- DNS通常是由其他应用层协议所使用的，包括HTTP、SMTP等。其作用则是：将用户提供的主机名解析为IP地址
- DNS的一种简单设计就是在因特网上只使用一个DNS服务器，该服务器包含所有的映射。很明显这种设计是有很大的问题的：
    -  单点故障：如果该DNS服务器崩溃，全世界的网络随之瘫痪
    -  通信容量：单个DNS服务器必须处理所有DNS查询
    -  远距离的集中式数据库：单个DNS服务器必须面对所有用户，距离过远会有严重的时延。
    -  维护：该数据库过于庞大，还需要对新添加的主机频繁更新。
- 所以，DNS被设计成了一个分布式、层次数据库

# DNS解析过程
以www.163.com为例:
- 客户端打开浏览器，输入一个域名。比如输入www.163.com，这时，客户端会发出一个DNS请求到本地DNS服务器。本地DNS服务器一般都是你的网络接入服务器商提供，比如中国电信，中国移动。
- 查询www.163.com的DNS请求到达本地DNS服务器之后，本地DNS服务器会首先查询它的缓存记录，如果缓存中有此条记录，就可以直接返回结果。如果没有，本地DNS服务器还要向DNS根服务器进行查询。
- 根DNS服务器没有记录具体的域名和IP地址的对应关系，而是告诉本地DNS服务器，你可以到域服务器上去继续查询，并给出域服务器的地址。
- 本地DNS服务器继续向域服务器发出请求，在这个例子中，请求的对象是.com域服务器。.com域服务器收到请求之后，也不会直接返回域名和IP地址的对应关系，而是告诉本地DNS服务器，你的域名的解析服务器的地址。
- 最后，本地DNS服务器向域名的解析服务器发出请求，这时就能收到一个域名和IP地址对应关系，本地DNS服务器不仅要把IP地址返回给用户电脑，还要把这个对应关系保存在缓存中，以备下次别的用户查询时，可以直接返回结果，加快网络访问。

# DNS和HTTPDNS
https://www.cnblogs.com/jimmyhe/p/11279762.html

# 资料
[http协议各版本差异](https://blog.51cto.com/13932385/2393194?source=dra)